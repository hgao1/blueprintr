---
title: "A Walkthrough of blueprintr"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{A Walkthrough of blueprintr}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

<style>
div.vg-warning {
  background-color:#FFFCE8;
  padding:5px;
}

div.vg-warning span:before {
  content: "‚ö†Ô∏è Warning: ";
}

div.vg-info {
  background-color:#EBFBFF;
  padding:5px;
}

div.vg-info span:before {
  content: "üí° Note: ";
}
</style>

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>"
)

set.seed(0x7bae)

cache_location <- tempdir()

drake::clean(cache = drake::drake_cache(cache_location))
```

`blueprintr` is a plugin to [drake](https://github.com/ropensci/drake) or [targets](https://cran.r-project.org/web/packages/targets/) that adds automated steps for tabular dataset documentation and testing. This package creates a replicable framework to prevent programming issues from affecting your analysis results.

# Installation 

```{r setup}
install.packages("remotes")
remotes::install_github("nyuglobalties/blueprintr")
```

# Basic Use

The top level of the `blueprintr` workflow is a "blueprints" directory, consisting of `.R` files-- each a blueprint. 
Each blueprint will instruct drake or targets on how to build a specific dataset and allows the user to specify any tests or checks that need to be done on the dataset. 

`blueprintr` has five "steps" (targets) per blueprint:

Target name             | Description
------------------------|--------------
`{blueprint}_initial`   | The result of running the blueprint's `command`
`{blueprint}_blueprint` | A copy of the blueprint to be used throughout the plan
`{blueprint}_meta`      | A copy of the dataset metadata --- if the metadata file doesn't exist, it will be created in this step
`{blueprint}_checks`    | Runs all tests on the `{blueprint}_initial` target
`{blueprint}`           | The built dataset after running some cleanup tasks

<div class="vg-warning"><span>when writing other targets in your plan, it is advised to **not** refer to the `{blueprint}_initial` step since it could have problems which are discovered in the `{blueprint}_checks` step.</span></div>

`blueprintr` takes three arguments:
  * name : the name of your generated dataset 
  * description: a description of your dataset
  * command: any functions that need to be applied in order to build the dataset. 

Our first blueprint will create a dataset with the first few rows of a dataset `dat`:

```{r}
blueprint(
  "dataset_name",
  description = "The first few rows of the a dataset",
  command = {
    # Code needed for building this target
    dat |>
      head()
  }
)
```

You can create this blueprint, or multiple blueprints at once, via the pipeline using: 
```{r}
# Example in targets
targets::tar_make()

# Example in drake
drake::make()
```


After creating a blueprint, you can load it anywhere in the pipeline via: 
```{r}
# In targets:
targets::tar_load(dataset_name)

dataset_name

#> <blueprint: 'dataset_name'>
#>
#> Description: The first six rows of the a dataset
#> Annotations: DISABLED
#> Metadata location: '/Users/patrickanker/dev/blueprintr/blueprints/dat_name.csv'
#>
#> -- Command --
#> Workflow command:
#> {
#>     dat |>
#>      head()
#> }
#>
#> Raw command:
#> {
#>     dat |>
#>      head()
#> }
```
